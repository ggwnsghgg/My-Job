## 2025-09-09 작업 정리 (회계 접근제어 & 재고 예약)

### 회계 접근제어 (iz_account)
- 목표: `회계 기능 표시 - 읽기 전용`만 `is_blocked=True` 저널 전표가 보이지 않도록 숨김 (에러 대신 비가시화).
- 구현 요약:
  - `account.move` 확장: `is_restricted_journal`(compute from `journal_id.is_blocked`).
  - Python 오버라이드만 사용 (레코드룰 제거):
    - `search() / search_read()`: 읽기전용이면서 매니저/전체회계가 아닌 경우 도메인에 `[('is_restricted_journal', '=', False)]` 강제 추가.
    - `read()`: 동일 조건에서 `is_restricted_journal=True` 레코드 필터링 후 반환(AccessDenied 미사용).
  - 예외 그룹: `account.group_account_manager`, `account.group_account_user`.
  - 진단 로그는 확인 후 모두 제거 완료.
- 효과:
  - 읽기전용: 차단 저널 전표 미표시(리스트/폼 모두).
  - 매니저/관리자: 전체 가시화.

### 재고 예약 엄격화 (Kim's Asia)
- 목표: 예약된 재고가 있을 경우, 이동 가능 수량은 예약 제외 나머지 수량만 허용.
- 코어(Odoo 17): 기본적으로 가용 = `quantity - reserved_quantity` 기준으로 예약/이동 처리.
- 커스텀 보강:
  - 파일: `custom/20240501-Kim-s-Asia/ka_sale_product_expiry/models/stock_move.py`
  - 변경: 강제 LOT 이후 잔여 예약 2개 호출의 `strict`를 항상 `True`로 고정(과예약 경로 차단).
- 기대 동작:
  - 강제 LOT 가용만큼 예약 후, 잔여는 유통기한(>= 강제 LOT) 충족 LOT에서만 예약. 부족분은 미예약(부분예약) 유지.
  - 각 LOT의 `reserved_quantity`만 증가, 제품 `free_qty` 감소, `qty_available` 불변.

### 간단 테스트 시나리오
- LOT A(6, D1), LOT B(10, D2) 준비. SO 라인에 LOT A 지정, 수량 10.
  - D2 ≥ D1: A=6 예약, 잔여 4는 B에서 예약, 초과예약 없음.
  - D2 < D1: A=6 예약, 잔여 4 미예약(부분예약). 검증 시 백오더/대기.


